appId: com.traxettle.app
name: Group Creation Flow
---
- launchApp:
    clearState: true
- evalScript: ${output.runId = Date.now().toString()}

# Ensure signed out
- tapOn:
    id: "dashboard-open-profile"
    optional: true
- tapOn:
    id: "profile-signout-button"
    optional: true
- tapOn:
    text: "Sign Out"
    optional: true

# Register admin
- tapOn:
    id: "login-go-register"
    optional: true
- tapOn:
    id: "register-display-name-input"
    optional: true
- tapOn:
    id: "login-go-register"
    optional: true
- extendedWaitUntil:
    visible:
      id: "register-display-name-input"
    timeout: 20000
- tapOn:
    id: "register-display-name-input"
- inputText: "Group Admin ${output.runId}"
- tapOn:
    id: "register-email-input"
- inputText: "grpadm${output.runId}@example.com"
- tapOn:
    id: "register-password-input"
- inputText: "Password123!"
- pressKey: Enter
- extendedWaitUntil:
    visible:
      id: "dashboard-create-event-button"
    timeout: 30000

# Create event
- tapOn:
    id: "dashboard-create-event-button"
- tapOn:
    id: "create-event-name-input"
- inputText: "Group Event ${output.runId}"
- tapOn:
    id: "create-event-currency-USD"
- tapOn:
    id: "create-event-settlement-same"
- tapOn:
    id: "create-event-submit-button"
- tapOn: "OK"
- assertVisible: "Group Event ${output.runId}"

# Invite a member so we can add them to a group
- extendedWaitUntil:
    visible:
      id: "event-detail-tab-participants"
    timeout: 20000
- tapOn:
    id: "event-detail-tab-participants"
- tapOn:
    id: "event-detail-open-invite-modal-participants"
- tapOn:
    id: "event-detail-invite-email-input"
- inputText: "grpmb${output.runId}@example.com"
- tapOn:
    text: "Send"
- tapOn:
    text: "Send"
    optional: true
- extendedWaitUntil:
    notVisible: "Invite to Event"
    timeout: 10000

# Switch to user-2 to accept invite
- launchApp:
    clearState: true
- tapOn:
    id: "dashboard-open-profile"
    optional: true
- tapOn:
    id: "profile-signout-button"
    optional: true
- tapOn:
    text: "Sign Out"
    optional: true
- tapOn:
    id: "login-go-register"
    optional: true
- tapOn:
    id: "register-display-name-input"
    optional: true
- tapOn:
    id: "login-go-register"
    optional: true
- extendedWaitUntil:
    visible:
      id: "register-display-name-input"
    timeout: 20000
- tapOn:
    id: "register-display-name-input"
- inputText: "Group Member ${output.runId}"
- tapOn:
    id: "register-email-input"
- inputText: "grpmb${output.runId}@example.com"
- tapOn:
    id: "register-password-input"
- inputText: "Password123!"
- pressKey: Enter
- tapOn:
    id: "dashboard-open-invitations"
- extendedWaitUntil:
    visible: "Accept"
    timeout: 10000
- tapOn: "Accept"
- assertVisible: "Accepted"
- tapOn: "OK"

# Switch back to admin
- launchApp:
    clearState: true
- extendedWaitUntil:
    visible:
      id: "login-email-input"
    timeout: 20000
- tapOn:
    id: "login-email-input"
- inputText: "grpadm${output.runId}@example.com"
- tapOn:
    id: "login-password-input"
- inputText: "Password123!"
- pressKey: Enter
- tapOn:
    id: "login-submit-button"
    optional: true
- extendedWaitUntil:
    visible: "Group Event ${output.runId}"
    timeout: 20000
- tapOn: "Group Event ${output.runId}"

# Navigate to groups tab and create a group
- tapOn:
    id: "event-detail-tab-groups"
- tapOn:
    id: "event-detail-create-group-button"
- tapOn:
    id: "create-group-name-input"
- inputText: "Family ${output.runId}"
- scrollUntilVisible:
    element:
      id: "create-group-submit-button"
    direction: DOWN
- tapOn:
    id: "create-group-submit-button"
    optional: true
- tapOn:
    text: "OK"
    optional: true
- extendedWaitUntil:
    visible: "Family ${output.runId}"
    timeout: 10000
- assertVisible: "Family ${output.runId}"
